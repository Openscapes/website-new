<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="NASA Openscapes Mentors, Erin Robinson, Julie Lowndes, Andy Barrett, Aaron Friesz, Alexis Hunzinger, Luis Lopez, Catalina Oaida, Jack McNelis, Christine Smit, Amy Steiker, Makhan Virdi">
<meta name="dcterms.date" content="2022-05-12">

<title>From downloading data to Cloud access: NASA Openscapes Champions Wrap-up</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon/favicon_fullres.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>
    .quarto-title-block .quarto-title-banner,
    .quarto-title-block .quarto-title-banner h1,
    .quarto-title-block .quarto-title-banner h2,
    .quarto-title-block .quarto-title-banner h3,
    .quarto-title-block .quarto-title-banner h4,
    .quarto-title-block .quarto-title-banner h5,
    .quarto-title-block .quarto-title-banner h6
    {
      color: #333333;
background: #F8D98F;
    }
    </style>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo/openscapes_hex_badge.png" alt="A stylized landscape showing rolling hills in different shades of orange, with purple flowers along the ridgelines. Subtle gridlines on the hills and circle packing in the flowers give a nod to data in the environment." class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">HOME</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">ABOUT</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../../who_are_we.html" rel="" target="">
 <span class="dropdown-text">WHO ARE WE?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../approach.html" rel="" target="">
 <span class="dropdown-text">OUR APPROACH</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../media.html" rel="" target="">
 <span class="dropdown-text">MEDIA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../team.html" rel="" target="">
 <span class="dropdown-text">OUR TEAM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../code_of_conduct.html" rel="" target="">
 <span class="dropdown-text">CODE OF CONDUCT</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-initiatives" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">INITIATIVES</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-initiatives">    
        <li>
    <a class="dropdown-item" href="../../champions_program.html" rel="" target="">
 <span class="dropdown-text">CHAMPIONS PROGRAM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reflections_program.html" rel="" target="">
 <span class="dropdown-text">REFLECTIONS PROGRAM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pathways_to_open_science_program.html" rel="" target="">
 <span class="dropdown-text">PATHWAYS TO OPEN SCIENCE PROGRAM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../mentors_framework.html" rel="" target="">
 <span class="dropdown-text">MENTORS FRAMEWORK</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">BLOG</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-get-involved" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">GET INVOLVED</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-get-involved">    
        <li>
    <a class="dropdown-item" href="../../connect.html" rel="" target="">
 <span class="dropdown-text">CONNECT WITH US</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../events.html" rel="" target="">
 <span class="dropdown-text">ATTEND AN EVENT</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources.html" rel="" target="">
 <span class="dropdown-text">FIND LEARNING RESOURCES</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/openscapes" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/openscapes" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:hello@openscapes.org" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page">
      <h1 class="title">From downloading data to Cloud access: NASA Openscapes Champions Wrap-up</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">community</div>
                <div class="quarto-category">champions</div>
                <div class="quarto-category">nasa-framework</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>NASA Openscapes Mentors, Erin Robinson, Julie Lowndes, Andy Barrett, Aaron Friesz, Alexis Hunzinger, Luis Lopez, Catalina Oaida, Jack McNelis, Christine Smit, Amy Steiker, Makhan Virdi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 12, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block column-page" id="quarto-document-content">




<p><em>In Spring 2022 we led our first NASA Openscapes Champions Cohort for research teams that work with NASA EarthData. This cohort is funded by NASA and part of our <a href="https://nasa-openscapes.github.io/">NASA Openscapes Framework project</a>. For this Cohort, we co-led the cohort with the NASA DAAC mentors and we focused on shifting toward Open science, collaborative, reproducible practices to support research teams as they transition from the download model to the Cloud. We also actively experimented with cloud data access through the Openscapes 2i2c-hosted JupyterHub.</em></p>
<p><em>Quick links:</em></p>
<ul>
<li>Cohort webpage: <a href="https://nasa-openscapes.github.io/2022-nasa-champions/" class="uri">https://nasa-openscapes.github.io/2022-nasa-champions/</a></li>
</ul>
<hr>
<section id="nasa-champions-cohort-overview" class="level2">
<h2 class="anchored" data-anchor-id="nasa-champions-cohort-overview"><strong>NASA Champions Cohort overview</strong></h2>
<p>The <a href="https://nasa-openscapes.github.io/">NASA Openscapes</a> Framework project is a 3-year project to support scientists using NASA Earthdata from NASA’s Earth Observing System Data and Information System (EOSDIS) Distributed Active Archive Centers (DAACs), as they migrate workflows to the cloud. We are just wrapping up Year 1 and amazed at how much we have collectively accomplished this year with the DAAC mentors and participating DAACs as well as all the researchers and research teams we have worked with. You can read more about our first year in our <a href="https://github.com/NASA-Openscapes/how_we_work/blob/main/Openscapes_NASAProgressReport_2021.pdf">2021 annual report</a>.&nbsp;</p>
<p>As part of this work, with the DAAC mentors, we co-led our first NASA Openscapes Champions cohort. Based on Openscapes’ flagship program, Openscapes Champions, the<a href="https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fnasa-openscapes.github.io%2Fchampions&amp;data=04%7C01%7Cjustin.l.rice%40nasa.gov%7C5b955d1f1d65469df84c08d9e51aeea5%7C7005d45845be48ae8140d43da96dd17b%7C0%7C0%7C637792726110138768%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=sNPV5GG5PMhX04EhEDex32K1lUHZUy%2BDoZeK%2BjYppxY%3D&amp;reserved=0">NASA Openscapes Champions Cohort</a> was a professional development and mentorship opportunity for early adopter, science teams that use NASA Earthdata and were interested in migrating their existing workflows to the cloud through collaborative open data science practices. The Openscapes Champions Cohort ran formally in March - April 2022.&nbsp;</p>
<p>The ten research teams who participated were interested in a wide variety of NASA Earthdata and various stages of cloud technology familiarity. You can learn more about their research below. Together as a Champions cohort they discussed what worked and didn’t work as they migrated workflows to the cloud, with a focus on collaboration and open science. We met as a cohort five times over two months, on alternating Fridays. Each cohort call included a welcome and code of conduct reminder, two teaching sessions with time for reflection in small groups or silent journaling and group discussion, before closing with suggestions for future team meeting topics (“Seaside Chats”), Efficiency Tips, and Inclusion Tips. Additional hands-on clinics and coworking sessions were scheduled within this period and will extend for the next two months to support these teams as they continue to work on the cloud workflow migration. In addition, the teams were supported by the Openscapes DAAC mentors and staff and Element84 and had access to Openscapes’ 2i2c Jupyter Hub, which will continue for the next year.</p>
<br>
<center>
<img src="../../img/blog/zoom-2022-nasa-champions.png" width="700px">
<figcaption>
Class photo of NASA Champions.
</figcaption>
</center>
<p><br></p>
</section>
<section id="what-did-participants-achieve" class="level2">
<h2 class="anchored" data-anchor-id="what-did-participants-achieve"><strong>What did participants achieve?</strong></h2>
<p>Just like our DAAC mentors have built collaborative bridges across the distributed data centers to identify the common parts of cloud data access over the first year of our project, this cohort was an opportunity to connect NASA Earthdata users, building a community that is eager to use data in the cloud and provides a forum to discuss common techniques and challenges. The teams devoted at least 8 hours a month to focus on their workflows. In this time, they thought through and discussed their current NASA Earthdata workflows and planned and experimented with transitioning their workflows to the cloud using Openscapes’ 2i2c-hosted Jupyter Hub as a first step. As in other Openscapes Champions cohorts, teams also realized the power of onboarding to create more resilient labs and they explored creating collaborative spaces for their teams through Google Drive, Slack, and GitHub.&nbsp;</p>
<p>Themes we revisited throughout the cohort included:&nbsp;</p>
<p>The <strong>Open science underpinnings of the Openscapes Champions program are important.</strong> During our last Champions session when the teams presented their pathways, it was amazing to hear how many times that teams were trying to use Github, Gitlab, or taking away other Open science practices in addition to the cloud-specific. It wasn’t all or nothing, they were taking small steps. It was also great to hear that a takeaway from this cohort is, working more openly and reproducibly provides for a more resilient workflow and team.&nbsp;</p>
<p>We <strong>intentionally focus on providing a kind welcome to technical topics.</strong> The kind space that we co-created with the teams and DAAC mentors provided an opportunity to collaborate as teams and ask questions that may in other settings go unasked because of fear that everyone else already knows. (Note: everyone else doesn’t know and will be glad you asked!) &nbsp;&nbsp;</p>
<p>This also led to <strong>several challenges</strong> that consistently surfaced and still need more focused effort to resolve. The vocabulary to understand the Cloud needs to be clearly explained. For example, what is an S3 bucket or a “requester pays bucket” and why does a user need to know about AWS West-2? Cloud cost is another challenge. We lower the barrier by providing the 2i2c Jupyterhub, but teams don’t want to depend on our hub. They want their own workspace and want to be able to predict costs more effectively. Finally, our work has been focused on Python because that was the language of choice for DAAC mentors and it is a widely used open-source language in the broader Earth science community. In the Champions Cohort we had three teams using Matlab and one team using R; we need to think about how to expand our support and tutorial materials for these other languages.&nbsp;</p>
</section>
<section id="closing-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="closing-thoughts"><strong>Closing thoughts</strong></h2>
<p>As we indicated at the beginning of this blog, this transition isn’t one that is completed in 2.5 months and so this is not the end for this Cohort. We are moving from the structured sessions of the Champions program into two additional months of coworking time and 1-1 interactions with DAAC mentors and staff and Element84 in order to make lasting changes with cloud data access.&nbsp;</p>
<p>We will focus on specific topics like:&nbsp;</p>
<ul>
<li>Practicing GitHub workflows and teaching others on your team&nbsp;</li>
<li>Cloud spatial subsetting&nbsp;</li>
<li>Environment management for creating cloud computing space that is reproducible and scalable (e.g.&nbsp;docker images)&nbsp;</li>
<li>Dask/Pangeo software stack to enable scalable processing&nbsp;</li>
<li>Cloud costs and setup&nbsp;</li>
<li>NetCDF to Zarr</li>
<li>Docker containers&nbsp;</li>
</ul>
<p>Finally, we are grateful to this Champion Cohort’s early adopter spirit, their time and effort to make this migration, and all of the feedback and input they provided. They all participated in this cohort knowing that they were some of the first research teams to use NASA Earthdata in the cloud and that they were the first NASA Openscapes Champions cohort. This meant that there would be technical challenges as we work out migrating to the cloud, yet what they learn will make it easier for subsequent teams making this same shift. It also exhibited the reciprocal learning that happens; we will refine the NASA Openscapes Champions as we plan for our next cohort and our work with the DAAC mentors in year 2.</p>
</section>
<section id="nasa-openscapes-champions-teams" class="level2">
<h2 class="anchored" data-anchor-id="nasa-openscapes-champions-teams"><strong>NASA Openscapes Champions Teams</strong></h2>
<p>The <strong>Cryosphere Geophysics and Remote Sensing (CryoGARS) Glaciology Team</strong> at Boise State University analyzes modern changes to the Earth’s cryosphere, with a focus on rapid changes in glacier flow, glacier-ocean interactions, iceberg melting, and seasonal snow accumulation and melt. Nearly all of our projects use Landsat imagery to map changes in glacier, iceberg, and/or snow extent. Several projects also use Landsat data to map glacier velocities or rely on NASA-produced glacier velocities computed from Landsat and Sentinel-2 data. We also use ICESat-2 data to map glacier volume change and seasonal snow in mountain regions. We look forward to using more cloud resources so that we can expand our analyses in space and time in order to advance our understanding of Cryosphere change!</p>
<p>The <strong>Mapes Team</strong> at the University of Miami studies atmospheric dynamics through multi-source data synthesis, with global grids as the glue. The global grids are huge, so downloading is out of the question. Fetching from aggregations (THREDDS, GDS) works for case studies, but sometimes we need to process it all (simplest example: make a multi-year climatology, to give context to actual fields as “anomalies”). So the data lake in the cloud will be a nice resource, and open new vistas like machine learning which always benefits from more data.</p>
<p>The <strong>Cornillon Team</strong> at the University of Rhode Island has several projects making use of MODIS and VIIRS sea surface temperature (SST). The project of focus for this cohort has been the statistical description of the location, strength, and temporal evolution of SST fronts. As part of this project, we developed an algorithm to unmask pixels improperly flagged as cloud contaminated in the standard MODIS SST products. The improved masks will be made available to the community at large as will the fronts identified by our edge detection algorithm.&nbsp;</p>
<p>The <strong>Ladies of Landsat Team</strong> has members from USGS, UCSB, and the University of Arizona. Kate uses dense time series of Landsat data to build harmonic models to predict land use cover and land use change and its links to climatological signals. Crista and Sarah research the human dimensions of earth observation data, such as Landsat. Nikki uses NASA drought models to map climate hazards in her Navajo Nation community. The research project “Power of the Pixel: Connecting Indigenous Communities through Remote Sensing in the United States” combines the power of all three foci to use NASA/USGS Landsat data to build earth observation capacity in Indigenous communities across the United States.</p>
<p>The <strong>SASSIE Team</strong> has members from the University of Washington, JPL, and APL. They are part of the NASA salinity and SWOT science teams, and regularly use satellite salinity, temperature, altimetry and sea ice data, as well as in situ holdings (SPURS-2, upcoming SASSIE experiment).</p>
<p>The <strong>Tandon Team</strong> at the University of Massachusetts Dartmouth uses remotely sensed data to setup the larger scale perspectives for our more in depth analysis and cruise based work for in-situ experimental data from initiatives in the Indian Ocean such as ASIRI and MISOBOB.</p>
<p>The <strong>Palter Team</strong> at the University of Rhode Island uses NASA data to compare with in-situ observations taken from ships and Uncrewed Surface Vehicles. NASA data provides additional parameters (like ocean surface topography) that are useful in the understanding of in-situ data (for example identifying fronts in the ACC). We have also used ocean color data from MODIS-Aqua to map distributions of ocean surface properties, such as chlorophyll concentration &amp; sea surface salinity (region-specific algorithm), to analyze seasonal, annual, and decadal trends of key biogeochemical processes in the ocean.</p>
<p>The <strong>Just Team</strong> at the Icahn School of Medicine at Mount Sinai uses earth observations to reconstruct ground-level environmental exposures to fine particulate matter, air temperature, and humidity which we use in epidemiologic health studies with cohorts and large registries in the US and Mexico. In a project that started out by seeking to understand the pattern of error in Aerosol Optical Depth (AOD) retrievals, we have developed an R-based reproducible workflow using the targets package for collocating and correcting AOD from the MAIAC algorithm (product MCD19A2 for Aqua and Terra) versus ground stations using gradient-boosted machine learning. This workflow adds reproducibility and extensibility for further development and new applications, building on results we have published for AOD (<a href="https://doi.org/10.3390/rs10050803)" class="uri">https://doi.org/10.3390/rs10050803)</a> and for column water vapor (<a href="https://doi.org/10.5194/amt-13-4669-2020" class="uri">https://doi.org/10.5194/amt-13-4669-2020</a>; data/code in Zenodo: 10.5281/zenodo.3568449).</p>
<p>The <strong>Hain/SPoRT Team</strong> is a directly funded NASA activity and engages with operational stakeholders to transition unique NASA observations and capabilities to improve decision-making.</p>
<p>The <strong>Roberts Team</strong> supports evaluation of global energy and water budgets, develops retrieval algorithms and climate data records (e.g.&nbsp;SeaFlux V1), evaluates air-sea interaction and ocean winds, and downscales and bias corrects models for use in hydrologic and agricultural modeling).</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Openscapes is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attributions 4.0 International License</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This website is built with <i class="fa-solid fa-heart" title="a heart" aria-label="heart"></i> and <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>